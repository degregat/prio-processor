#!/bin/bash
set -exuo pipefail

### start variable export
set -a

: ${MINIO_ACCESS_KEY:=admin}
: ${MINIO_SECRET_KEY:=password}
: ${BUCKET_INTERNAL:=data/server-a}
: ${BUCKET_EXTERNAL:=data/server-b}

: ${N_DATA:=3}
: ${BATCH_ID:=data}

: ${SERVER_ID:=A}
# Generated by running `prio secret-seed` once and `prio keygen` twice
: ${SHARED_SECRET:="y3n4EU/0b/+svzWVDcmTlw=="}
: ${PRIVATE_KEY_HEX:=ED833DF8794F1119C50CF5F12300899A49DB1569CC4701D1D0A00A89A90F5366}
: ${PUBLIC_KEY_HEX_INTERNAL:=29AB0542A507794EA08A71B73AA502752D5690C5489C4483699D33C3E752643B}
: ${PUBLIC_KEY_HEX_EXTERNAL:=07514F5F7FDAA656928826BE968697E51672BEFF4DF1511A3916B210B3A7EB49}
# private external 05F495EC275AF525644F77C572F373216ED9277DB65FBF9E713FECBA714BE756

: ${INPUT:=$BUCKET_INTERNAL/raw}
: ${INPUT_INTERNAL:=$BUCKET_INTERNAL/intermediate/internal}
: ${INPUT_EXTERNAL:=$BUCKET_INTERNAL/intermediate/external}
: ${OUTPUT_INTERNAL:=$BUCKET_INTERNAL/intermediate/internal}
: ${OUTPUT_EXTERNAL:=$BUCKET_EXTERNAL/intermediate/external}
: ${OUTPUT:=$BUCKET_INTERNAL/processed}

set +a
### end variable export

python -m prio.spark.commands prio-spark
